<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment - Marriage Education</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1>Complete Your Purchase</h1>
      <nav>
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="shop.html">Shop</a>
        <a href="courses.html">Courses</a>
        <a href="blog.html">Blog</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <section class="payment-section">
    <div class="container">
      <div class="payment-container">
        <div class="order-summary">
          <h3>Order Summary</h3>
          <div class="order-item">
            <span id="modal-product-name">SBD for Dummies</span>
            <span id="modal-product-price">$19.99</span>
          </div>
          <div class="order-total">
            <strong>Total: <span id="order-total">$19.99</span></strong>
          </div>
        </div>

        <div class="payment-methods">
          <h3>Choose Payment Method</h3>
          
          <div class="payment-methods-header">
            <h3>üí≥ Secure Credit Card Payment</h3>
            <p>Powered by Stripe - trusted by millions worldwide</p>
          </div>

          <div class="payment-form-container">
            <div class="credit-card-notice">
              <h4>üí≥ Credit Card Payment</h4>
              <p><strong>Secure and Fast!</strong> Pay with your credit or debit card.</p>
              <p>Powered by <strong>Stripe</strong> - trusted by millions worldwide.</p>
            </div>

            <form id="payment-form" class="payment-form">
              <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" placeholder="Enter your email address" required>
              </div>

              <div class="form-group">
                <label for="name">Full Name</label>
                <input type="text" id="name" name="name" placeholder="Enter your full name" required>
              </div>

              <div class="form-group">
                <label>Card Information</label>
                <div id="card-element">
                  <!-- Stripe Elements will render here -->
                </div>
                <div id="card-errors" role="alert"></div>
              </div>

              <button type="submit" id="submit" class="pay-button">
                <span id="button-text">Pay Now</span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="security-footer">
    <div class="container">
      <div class="security-badges">
        <span>üîí SSL Encrypted</span>
        <span>üõ°Ô∏è PCI Compliant</span>
        <span>üõ°Ô∏è Fraud Protected</span>
      </div>
    </div>
  </footer>

  <script src="js/payment-processor.js"></script>
  <script src="js/analytics.js"></script>

  <script>
    // Get product details from URL
    const urlParams = new URLSearchParams(window.location.search);
    const product = urlParams.get('product') || 'sbd-dummies';
    const price = urlParams.get('price') || '19.99';

    // Product mapping
    const products = {
      'sbd-dummies': { name: 'SBD for Dummies', price: '19.99' },
      'sbd-standard': { name: 'Sex By Design - Standard Edition', price: '29.99' },
      'sbd-canonical': { name: 'Sex By Design - Canonical Edition', price: '39.99' },
      'complete-sbd-library': { name: 'Complete SBD Library', price: '189.99' }
    };

    // Update page with product info
    const productInfo = products[product] || products['sbd-dummies'];
    document.getElementById('modal-product-name').textContent = productInfo.name;
    document.getElementById('modal-product-price').textContent = '$' + productInfo.price;
    document.getElementById('order-total').textContent = '$' + productInfo.price;
    document.getElementById('button-text').textContent = 'Pay $' + productInfo.price;

    // Initialize Stripe - WORKING VERSION
    const stripe = Stripe('pk_live_51S4PByJFVcOiuICpKXZ5oFjIWuhbZRNuFTBdBfk8II61iBhyOVhzQQJ22AUUM938xCLobMr23IVI8miaPEmsRYTj00yKjh6776');
    const elements = stripe.elements();

    // Create card element
    const cardElement = elements.create('card');
    cardElement.mount('#card-element');

    // Handle real-time validation errors
    cardElement.on('change', ({error}) => {
      const displayError = document.getElementById('card-errors');
      if (error) {
        displayError.textContent = error.message;
      } else {
        displayError.textContent = '';
      }
    });

    // Handle form submission
    const form = document.getElementById('payment-form');
    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const submitButton = document.getElementById('submit');
      submitButton.disabled = true;
      document.getElementById('button-text').textContent = 'Processing...';

      // Get form data
      const email = document.getElementById('email').value;
      const name = document.getElementById('name').value;

      try {
        // Create payment method
        const {paymentMethod, error} = await stripe.createPaymentMethod({
          type: 'card',
          card: cardElement,
          billing_details: {
            name: name,
            email: email,
          },
        });

        if (error) {
          document.getElementById('card-errors').textContent = error.message;
        } else {
          // Success! Payment method created
          console.log('Payment method created:', paymentMethod);
          
          // Here you would normally send to your backend
          // For now, show success message
          alert('Payment method created successfully! (This is a test - no actual charge was made)');
          
          // In production, you would:
          // 1. Send paymentMethod.id to your server
          // 2. Create a payment intent on the server
          // 3. Confirm the payment
        }
      } catch (err) {
        console.error('Error:', err);
        document.getElementById('card-errors').textContent = 'An unexpected error occurred.';
      }

      // Re-enable button
      submitButton.disabled = false;
      document.getElementById('button-text').textContent = 'Pay $' + productInfo.price;
    });
  </script>
</body>
</html>